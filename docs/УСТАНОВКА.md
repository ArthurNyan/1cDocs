# Инструкция по установке и настройке

Документация по установке необходимых инструментов для работы с проектом "1Стиль".

## Системные требования

### Операционные системы

- macOS 10.15+ (рекомендуется)
- Ubuntu 18.04+ / Debian 10+
- Windows 10+ (требуется установка через Git Bash или WSL)

### Необходимые инструменты

- **v8unpack** - распаковка конфигураций 1С
- **pandoc** - конвертация документов
- **weasyprint** - генерация PDF (рекомендуется)
- **Git** - управление версиями (опционально)

## Пошаговая установка

### 1. macOS (рекомендуемая среда)

```bash
# Установка через Homebrew (если не установлен)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Установка необходимых инструментов
brew install v8unpack pandoc weasyprint git

# Проверка установки
v8unpack --version
pandoc --version
weasyprint --version
```

### 2. Ubuntu/Debian

```bash
# Обновление системы
sudo apt update && sudo apt upgrade -y

# Установка базовых инструментов
sudo apt install -y curl wget git

# Установка pandoc
sudo apt install -y pandoc

# Установка Python для WeasyPrint
sudo apt install -y python3 python3-pip python3-wheel

# Установка системных зависимостей для WeasyPrint
sudo apt install -y build-essential python3-dev python3-cffi \
    libcairo2 libpango-1.0-0 libpangocairo-1.0-0 \
    libgdk-pixbuf2.0-0 libffi-dev shared-mime-info

# Установка WeasyPrint
pip3 install weasyprint

# Установка v8unpack
sudo apt install -y v8unpack

# Проверка установки
v8unpack --version
pandoc --version
weasyprint --version
```

### 3. Windows

#### Вариант A: Git Bash + Chocolatey

```powershell
# Установка Chocolatey (если не установлен)
Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

# Установка Git и инструментов
choco install git pandoc v8unpack

# Установка Python для WeasyPrint
choco install python

# Установка WeasyPrint через pip
pip install weasyprint
```

#### Вариант B: WSL (Windows Subsystem for Linux)

```bash
# В WSL Ubuntu следовать инструкциям для Ubuntu/Debian
wsl --install
```

## Проверка установки

### Быстрая проверка

```bash
# Запуск автоматической проверки из проекта
cd /path/to/1cDocs
./scripts.sh check
```

### Ручная проверка

```bash
# Проверка каждого инструмента
v8unpack --version
# Должен показать версию v8unpack

pandoc --version  
# Должен показать версию pandoc

weasyprint --version
# Должен показать версию weasyprint

# Тест генерации PDF
echo "# Тест" > test.md
pandoc test.md -o test.pdf --pdf-engine=weasyprint
rm test.md
```

### Проверка работы с конфигурацией

```bash
# Тест распаковки (если есть файл config.cf)
v8unpack -E config.cf temp_unpack/
# Должна создаться директория temp_unpack
rm -rf temp_unpack/
```

## Решение проблем

### Ошибка "v8unpack: command not found"

**macOS:**

```bash
brew install v8unpack
```

**Ubuntu/Debian:**

```bash
sudo apt install v8unpack
```

**Windows:**

```powershell
choco install v8unpack
```

### Ошибка "weasyprint: command not found"

**macOS:**

```bash
brew install weasyprint
```

**Ubuntu/Debian:**

```bash
sudo apt install python3-weasyprint
# или
pip3 install weasyprint
```

**Windows:**

```powershell
pip install weasyprint
```

### Ошибки генерации PDF

**Проблема с шрифтами (Linux/WSL):**

```bash
# Установка дополнительных шрифтов
sudo apt install -y fonts-liberation fonts-dejavu-fonts

# Альтернативный PDF движок
sudo apt install -y wkhtmltopdf
```

**Проблема с кодировкой русского текста:**

```bash
# Использование wkhtmltopdf вместо weasyprint
pandoc document.md -o output.pdf --pdf-engine=wkhtmltopdf --css=pdf-style.css
```

### Переключение между PDF движками

```bash
# WeasyPrint (лучше для русского текста)
pandoc doc.md -o output.pdf --pdf-engine=weasyprint --css=pdf-style.css

# wkhtmltopdf (альтернатива)
pandoc doc.md -o output.pdf --pdf-engine=wkhtmltopdf --css=pdf-style.css

# prince (коммерческий, качественный)
pandoc doc.md -o output.pdf --pdf-engine=prince --css=pdf-style.css
```

## Поддержка

При возникновении проблем:

1. Проверьте версии установленных инструментов
2. Убедитесь в корректности путей к файлам
3. Проверьте права доступа к файлам
4. Используйте команду `./scripts.sh check` для диагностики
